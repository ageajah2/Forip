<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Library — Mini Friv</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#48bfe3}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071021 0%,var(--bg) 100%);color:#e6eef6}
    .wrap{max-width:1200px;margin:28px auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    input[type=search]{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    select{padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;margin-top:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);cursor:pointer;display:flex;flex-direction:column}
    .thumb{width:100%;aspect-ratio:16/10;background:#071019;display:block;object-fit:cover}
    .meta{padding:10px}
    .title{font-size:14px;margin:0 0 6px 0}
    .tags{font-size:12px;color:var(--muted)}
    footer{margin-top:22px;color:var(--muted);font-size:13px}

    /* Modal/preview */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px}
    .modal.open{display:flex}
    .preview{width:100%;max-width:1024px;height:640px;background:#000;border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
    .preview iframe{flex:1;border:0}
    .preview .bar{display:flex;align-items:center;gap:8px;padding:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
    .small{font-size:12px;color:var(--muted)}

    /* responsive */
    @media (max-width:600px){.preview{height:80vh}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect width='24' height='24' rx='4' fill='%2348bfe3'/></svg>" alt="logo" width="40" height="40">
      <h1>Mini Game Library</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Cari game...">
        <select id="filter">
          <option value="all">Semua</option>
        </select>
        <button id="addBtn">+ Tambah (helper)</button>
      </div>
    </header>

    <main>
      <div id="grid" class="grid"></div>
      <footer>Tip: letakkan folder game di <code>/games/&lt;slug&gt;/index.html</code> dan tambahkan entry di <code>/games/games.json</code>.</footer>
    </main>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="preview" role="dialog" aria-modal="true">
      <div class="bar">
        <button id="close">Tutup</button>
        <div id="meta" class="small"></div>
        <div style="margin-left:auto;" class="small">Tekan ESC untuk tutup</div>
      </div>
      <iframe id="frame" src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
    </div>
  </div>

<script>
// Minimal, dependency-free. Loads games from /games/games.json
async function loadGames(){
  try{
    const res = await fetch('games/games.json', {cache: 'no-store'});
    if(!res.ok) throw new Error('games.json not found');
    const data = await res.json();
    window.GAMES = data;
    render(data);
    populateFilters(data);
  }catch(err){
    document.getElementById('grid').innerHTML = '<div style="padding:20px;color:var(--muted)">Tidak bisa memuat games.json — pastikan file <code>/games/games.json</code> ada. Lihat README di repo.</div>';
    console.error(err);
  }
}

function render(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  list.forEach(game => {
    const a = document.createElement('div');
    a.className = 'card';
    a.innerHTML = `
      <img class="thumb" loading="lazy" src="${escapeHtml(game.thumb||('games/'+game.slug+'/thumb.png'))}" alt="${escapeHtml(game.title)}">
      <div class="meta">
        <h3 class="title">${escapeHtml(game.title)}</h3>
        <div class="tags">${(game.tags||[]).slice(0,3).join(', ')}</div>
      </div>
    `;
    a.addEventListener('click', ()=> openPreview(game));
    grid.appendChild(a);
  })
}

function populateFilters(list){
  const set = new Set(['all']);
  list.forEach(g=> (g.tags||[]).forEach(t=>set.add(t)));
  const sel = document.getElementById('filter');
  sel.innerHTML = '';
  Array.from(set).forEach(v=>{
    const opt = document.createElement('option'); opt.value=v; opt.textContent=(v==='all'? 'Semua' : v); sel.appendChild(opt);
  });
}

function openPreview(game){
  const modal = document.getElementById('modal');
  const frame = document.getElementById('frame');
  const meta = document.getElementById('meta');
  frame.src = game.path || ('games/'+game.slug+'/index.html');
  meta.textContent = game.title + ' — ' + (game.author||'Tidak diketahui');
  modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
}

// helpers
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c]); }

// search & filter
const search = document.getElementById('search');
const filter = document.getElementById('filter');
search.addEventListener('input', ()=> applyFilter());
filter.addEventListener('change', ()=> applyFilter());
function applyFilter(){
  const q = (search.value||'').toLowerCase().trim();
  const tag = filter.value;
  const out = (window.GAMES||[]).filter(g=>{
    const matchQ = q==='' || g.title.toLowerCase().includes(q) || (g.tags||[]).join(' ').toLowerCase().includes(q);
    const matchTag = tag==='all' || (g.tags||[]).includes(tag);
    return matchQ && matchTag;
  });
  render(out);
}

// modal close
document.getElementById('close').addEventListener('click', closeModal);
window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });
function closeModal(){ const m=document.getElementById('modal'); m.classList.remove('open'); m.setAttribute('aria-hidden','true'); document.getElementById('frame').src='about:blank'; }

// "Add entry" helper: opens a prompt to create a JSON entry you can copy/paste into games.json
document.getElementById('addBtn').addEventListener('click', ()=>{
  const title = prompt('Judul game (contoh: Flappy Bird)');
  if(!title) return;
  const slug = (prompt('Slug folder (tanpa spasi, contoh: flappy-bird)')||title.toLowerCase().replace(/[^a-z0-9\-]/g,'-'));
  const thumb = `games/${slug}/thumb.png`;
  const path = `games/${slug}/index.html`;
  const tags = (prompt('Tag, pisahkan koma (contoh: arcade,one-player)')||'').split(',').map(s=>s.trim()).filter(Boolean);
  const author = prompt('Author (opsional)')||'';
  const entry = { title, slug, thumb, path, tags, author };
  const jsonLine = JSON.stringify(entry, null, 2);
  prompt('Salin blok JSON ini dan tambahkan ke games/games.json', jsonLine);
});

// init
loadGames();
</script>
</body>
</html>