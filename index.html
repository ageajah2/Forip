<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Library — Forip</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#48bfe3;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071021 0%,var(--bg) 100%);color:#6d8eaf}
    .wrap{max-width:1200px;margin:28px auto;padding:16px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    input[type=search]{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    select{padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;margin-top:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);cursor:pointer;display:flex;flex-direction:column}
    .thumb{width:100%;aspect-ratio:16/10;background:#071019;display:block;object-fit:cover}
    .meta{padding:10px}
    .title{font-size:14px;margin:0 0 6px 0}
    .tags{font-size:12px;color:var(--muted)}
    footer{margin-top:22px;color:var(--muted);font-size:13px}

    /* Modal/preview — RESPONSIVE improvements */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:9999}
    .modal.open{display:flex}
    /* Use aspect-ratio for nice responsiveness. Width limited by vw, height limited by vh */
    .preview{
      width:min(1200px, 94vw);
      aspect-ratio: 20 / 9; /* default aspect ratio, scales responsively */
      max-height: 94vh;
      background:#000;border-radius:12px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(2,6,23,0.7);
      position:relative;
    }
    /* If the viewport is tall (mobile portrait), prefer height: */
    @media (max-aspect-ratio: 16/9){
      .preview{ width: 96vw; height: 80vh; aspect-ratio: initial; }
    }

    .preview iframe{width:100%;height:100%;border:0;display:block}
    .preview .bar{display:flex;align-items:center;gap:8px;padding:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);z-index:2}
    .small{font-size:12px;color:var(--muted)}

    /* control buttons */
    .btn{
      appearance:none;border:0;background:transparent;color:inherit;padding:6px 10px;border-radius:8px;cursor:pointer;
    }
    .btn:hover{background:rgba(255,255,255,0.03)}
    .btn:active{transform:translateY(1px)}

    /* make the modal content use full available space on very small screens */
    @media (max-width:480px){
      .preview{ width:98vw; height:84vh; border-radius:10px; }
      .preview .bar{padding:6px}
    }

		  .grid{
	  display:grid;
	  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
	  gap:14px;
	}
	
	@media (max-width: 600px){
	  .grid{
	    grid-template-columns: repeat(2, 1fr);
	  }
	}

		  @media (max-width: 600px){
	  header{
	    align-items:flex-start;
	  }
	
	  .controls{
	    width:100%;
	    margin-left:0;
	  }
	
	  .controls input,
	  .controls select,
	  .controls button{
	    flex:1;
	    min-width:0;
	  }
	}

	  @media (max-width: 600px){
  .wrap{
    max-width: 100%;
    margin: 12px 0;
    padding: 12px;
  }
}



  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect width='24' height='24' rx='4' fill='%2348bfe3'/></svg>" alt="logo" width="40" height="40">
      <h1>FORIP - Mini Games</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Cari game...">
        <select id="filter">
          <option value="all">Semua</option>
        </select>
        <button id="addBtn">+Help</button>
      </div>
    </header>

    <main>
      <div id="grid" class="grid"></div>
	  <footer>Tip: Permainan biasanya menggunakan WASD atau arrow keys.</footer>
      <footer>Tip for Dev: Letakkan folder game di repo <code>/games/&lt;slug&gt;/index.html</code> dan tambahkan entry di <code>/games/games.json</code>.</footer>
    </main>
  </div>

  <div id="modal" class="modal" aria-hidden="true">
    <div class="preview" role="dialog" aria-modal="true">
      <div class="bar">
        <button id="close" class="btn">Tutup</button>
        <div id="meta" class="small"></div>

        <!-- NEW: controls to open fullscreen or open game in new tab -->
        <div style="margin-left:auto;display:flex;gap:6px;">
          <button id="openTab" class="btn small">Buka di Tab Baru</button>
          <button id="toggleFS" class="btn small">Fullscreen</button>
        </div>
      </div>

      <!-- iframe container keeps full area; iframe will resize with .preview -->
      <iframe id="frame" src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
    </div>
  </div>

<script>
/* ====== Main logic (mostly unchanged) ====== */
/* This script loads games.json and renders cards; modal preview now supports fullscreen + open in new tab.
   Improvements made:
   - .preview uses CSS aspect-ratio so frame scales nicely on wide and tall viewports
   - iframe fills the preview box
   - 'Buka di Tab Baru' opens the game's path in a new window (useful for mobile fullscreen)
   - 'Fullscreen' uses Fullscreen API on the preview container
*/

async function loadGames(){
  try{
    const res = await fetch('games/games.json', {cache: 'no-store'});
    if(!res.ok) throw new Error('games.json not found');
    const data = await res.json();
    window.GAMES = data;
    render(data);
    populateFilters(data);
  }catch(err){
    document.getElementById('grid').innerHTML = '<div style="padding:20px;color:var(--muted)">Tidak bisa memuat games.json — pastikan file <code>/games/games.json</code> ada. Lihat README di repo.</div>';
    console.error(err);
  }
}

function render(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  list.forEach(game => {
    const a = document.createElement('div');
    a.className = 'card';
    a.innerHTML = `
      <img class="thumb" loading="lazy" src="${escapeHtml(game.thumb || ('games/' + game.slug + '/thumb.png'))}" alt="${escapeHtml(game.title)}">
      <div class="meta">
        <h3 class="title">${escapeHtml(game.title)}</h3>
        <div class="tags">${(game.tags || []).slice(0,3).join(', ')}</div>
      </div>
    `;
    a.addEventListener('click', ()=> openPreview(game));
    grid.appendChild(a);
  })
}

function populateFilters(list){
  const set = new Set(['all']);
  list.forEach(g=> (g.tags||[]).forEach(t=>set.add(t)));
  const sel = document.getElementById('filter');
  sel.innerHTML = '';
  Array.from(set).forEach(v=>{
    const opt = document.createElement('option'); opt.value=v; opt.textContent=(v==='all'? 'Semua' : v); sel.appendChild(opt);
  });
}

/* ====== Responsive preview functions ====== */
const modal = document.getElementById('modal');
const frame = document.getElementById('frame');
const meta = document.getElementById('meta');
let currentGamePath = '';

function openPreview(game){
  currentGamePath = game.path || ('games/'+game.slug+'/index.html');
  frame.src = currentGamePath;
  meta.textContent = game.title + ' — ' + (game.author||'Tidak diketahui');
  modal.classList.add('open'); modal.setAttribute('aria-hidden','false');

  // small accessibility: focus close button
  document.getElementById('close').focus();
}

function closeModal(){
  const m = document.getElementById('modal');
  m.classList.remove('open');
  m.setAttribute('aria-hidden','true');
  // clear iframe to stop audio/CPU in background
  frame.src = 'about:blank';
  // exit fullscreen if active
  if(document.fullscreenElement) document.exitFullscreen().catch(()=>{});
}

/* Fullscreen toggle */
document.getElementById('toggleFS').addEventListener('click', async () => {
  const preview = document.querySelector('.preview');
  if(!document.fullscreenElement){
    try{
      await preview.requestFullscreen({ navigationUI: 'hide' });
    }catch(e){ console.warn('Fullscreen failed', e); }
  } else {
    document.exitFullscreen().catch(()=>{});
  }
});

/* Open in new tab (useful for mobile devices where fullscreen may be blocked) */
document.getElementById('openTab').addEventListener('click', () => {
  if(!currentGamePath) return;
  // open relative path in new tab
  window.open(currentGamePath, '_blank', 'noopener');
});

// GANTI seluruh fungsi escapeHtml lama dengan ini:
function escapeHtml(s){
  return String(s || '').replace(/[&<>"']/g, function(c){
    return ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    })[c];
  });
}
/* search & filter */
const search = document.getElementById('search');
const filter = document.getElementById('filter');
search.addEventListener('input', ()=> applyFilter());
filter.addEventListener('change', ()=> applyFilter());
function applyFilter(){
  const q = (search.value||'').toLowerCase().trim();
  const tag = filter.value;
  const out = (window.GAMES||[]).filter(g=>{
    const matchQ = q==='' || g.title.toLowerCase().includes(q) || (g.tags||[]).join(' ').toLowerCase().includes(q);
    const matchTag = tag==='all' || (g.tags||[]).includes(tag);
    return matchQ && matchTag;
  });
  render(out);
}

/* modal close handlers */
document.getElementById('close').addEventListener('click', closeModal);
window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

/* Add entry helper (unchanged) */
document.getElementById('addBtn').addEventListener('click', ()=>{
  const title = prompt('Permainan biasanya menggunakan spasi, WASD atau arrow keys.\nFor dev: Buat judul game (contoh: Tanam Sawit)');
  if(!title) return;
  const slug = (prompt('Slug folder (tanpa spasi, contoh: tanam-sawit)')||title.toLowerCase().replace(/[^a-z0-9\\-]/g,'-'));
  const thumb = `games/${slug}/thumb.png`;
  const path = `games/${slug}/index.html`;
  const tags = (prompt('Tag, pisahkan koma (contoh: arcade,politic)')||'').split(',').map(s=>s.trim()).filter(Boolean);
  const author = prompt('Author (opsional)')||'';
  const entry = { title, slug, thumb, path, tags, author };
  const jsonLine = JSON.stringify(entry, null, 2);
  prompt('Salin blok JSON ini dan tambahkan ke repo games/games.json', jsonLine);
});

/* init */
loadGames();
</script>
</body>
</html>




